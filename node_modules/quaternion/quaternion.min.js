/*
Quaternion.js v1.2.1 27/07/2021

Copyright (c) 2021, Robert Eisele (robert@xarg.org)
Licensed under the MIT license.
*/
(function(A){function x(a,b){var c=Math.abs(a),d=Math.abs(b);return 0===a?Math.log(d):0===b?Math.log(c):3E3>c&&3E3>d?.5*Math.log(a*a+b*b):Math.log(a/Math.cos(Math.atan2(b,a)))}function r(a,b,c,d,e){if(void 0!==e)a.w=b,a.x=c,a.y=d,a.z=e;else{if("object"===typeof b&&void 0===d){if("w"in b||"x"in b||"y"in b||"z"in b){a.w=b.w||0;a.x=b.x||0;a.y=b.y||0;a.z=b.z||0;return}if("re"in b&&"im"in b){a.w=b.re;a.x=b.im;a.y=0;a.z=0;return}if(4===b.length){a.w=b[0];a.x=b[1];a.y=b[2];a.z=b[3];return}if(3===b.length){a.w=
0;a.x=b[0];a.y=b[1];a.z=b[2];return}throw Error("Invalid object");}if("string"===typeof b&&void 0===d){b=b.match(/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g);var g=1;c=0;d={i:"x",j:"y",k:"z"};if(null===b)throw Error("Parse error");for(e=a.w=a.x=a.y=a.z=0;e<b.length;e++){var f=b[e],l=b[e+1];if(" "!==f&&"\t"!==f&&"\n"!==f)if("+"===f)g++;else if("-"===f)c++;else{if(0===g+c)throw Error("Parse error"+f);g=d[f];if(void 0!==g)" "===l||isNaN(l)?f="1":(f=l,e++);else{if(isNaN(f))throw Error("Parser error");g=d[l];
void 0!==g&&e++}a[g||"w"]+=parseFloat((c%2?"-":"")+f);g=c=0}}if(0<g+c)throw Error("Parser error");}else void 0===b&&a!==k?(a.w=1,a.x=a.y=a.z=0):(a.w=b||0,c&&3===c.length?(a.x=c[0],a.y=c[1],a.z=c[2]):(a.x=c||0,a.y=d||0,a.z=e||0))}}function v(a,b,c){var d="";if(0!==a){""!==c?d+=0>a?" - ":" + ":0>a&&(d+="-");a=Math.abs(a);if(1!==a||""===b)d+=a;d+=b}return d}function h(a,b,c,d){if(!(this instanceof h))return new h(a,b,c,d);r(this,a,b,c,d)}var k={w:1,x:0,y:0,z:0};h.prototype={w:1,x:0,y:0,z:0,add:function(a,
b,c,d){r(k,a,b,c,d);return new h(this.w+k.w,this.x+k.x,this.y+k.y,this.z+k.z)},sub:function(a,b,c,d){r(k,a,b,c,d);return new h(this.w-k.w,this.x-k.x,this.y-k.y,this.z-k.z)},neg:function(){return new h(-this.w,-this.x,-this.y,-this.z)},norm:function(){var a=this.w,b=this.x,c=this.y,d=this.z;return Math.sqrt(a*a+b*b+c*c+d*d)},normSq:function(){var a=this.w,b=this.x,c=this.y,d=this.z;return a*a+b*b+c*c+d*d},normalize:function(){var a=this.w,b=this.x,c=this.y,d=this.z,e=Math.sqrt(a*a+b*b+c*c+d*d);if(e<
h.EPSILON)return h.ZERO;e=1/e;return new h(a*e,b*e,c*e,d*e)},mul:function(a,b,c,d){r(k,a,b,c,d);a=this.w;b=this.x;c=this.y;d=this.z;var e=k.w,g=k.x,f=k.y,l=k.z;return new h(a*e-b*g-c*f-d*l,a*g+b*e+c*l-d*f,a*f+c*e+d*g-b*l,a*l+d*e+b*f-c*g)},scale:function(a){return new h(this.w*a,this.x*a,this.y*a,this.z*a)},dot:function(a,b,c,d){r(k,a,b,c,d);return this.w*k.w+this.x*k.x+this.y*k.y+this.z*k.z},inverse:function(){var a=this.w,b=this.x,c=this.y,d=this.z,e=a*a+b*b+c*c+d*d;if(0===e)return h.ZERO;e=1/e;
return new h(a*e,-b*e,-c*e,-d*e)},div:function(a,b,c,d){r(k,a,b,c,d);a=this.w;b=this.x;c=this.y;d=this.z;var e=k.w,g=k.x,f=k.y,l=k.z,m=e*e+g*g+f*f+l*l;if(0===m)return h.ZERO;m=1/m;return new h((a*e+b*g+c*f+d*l)*m,(b*e-a*g-c*l+d*f)*m,(c*e-a*f-d*g+b*l)*m,(d*e-a*l-b*f+c*g)*m)},conjugate:function(){return new h(this.w,-this.x,-this.y,-this.z)},exp:function(){var a=this.x,b=this.y,c=this.z,d=Math.sqrt(a*a+b*b+c*c),e=Math.exp(this.w),g=e/d*Math.sin(d);return 0===d?new h(e,0,0,0):new h(e*Math.cos(d),a*g,
b*g,c*g)},log:function(){var a=this.w,b=this.x,c=this.y,d=this.z;if(0===c&&0===d)return new h(x(a,b),Math.atan2(b,a),0,0);var e=Math.sqrt(b*b+c*c+d*d);e=Math.atan2(e,a)/e;return new h(.5*Math.log(b*b+c*c+d*d+a*a),b*e,c*e,d*e)},pow:function(a,b,c,d){r(k,a,b,c,d);if(0===k.y&&0===k.z){if(1===k.w&&0===k.x)return this;if(0===k.w&&0===k.x)return h.ONE;if(0===this.y&&0===this.z){a=this.w;b=this.x;if(0===a&&0===b)return h.ZERO;c=Math.atan2(b,a);d=x(a,b);if(0===k.x){if(0===b&&0<=a)return new h(Math.pow(a,
k.w),0,0,0);if(0===a)switch(k.w%4){case 0:return new h(Math.pow(b,k.w),0,0,0);case 1:return new h(0,Math.pow(b,k.w),0,0);case 2:return new h(-Math.pow(b,k.w),0,0,0);case 3:return new h(0,-Math.pow(b,k.w),0,0)}}a=Math.exp(k.w*d-k.x*c);b=k.x*d+k.w*c;return new h(a*Math.cos(b),a*Math.sin(b),0,0)}}return this.log().mul(k).exp()},equals:function(a,b,c,d){r(k,a,b,c,d);a=h.EPSILON;return Math.abs(k.w-this.w)<a&&Math.abs(k.x-this.x)<a&&Math.abs(k.y-this.y)<a&&Math.abs(k.z-this.z)<a},isFinite:function(){return isFinite(this.w)&&
isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)},isNaN:function(){return isNaN(this.w)||isNaN(this.x)||isNaN(this.y)||isNaN(this.z)},toString:function(){var a=this.w,b=this.x,c=this.y,d=this.z;if(isNaN(a)||isNaN(b)||isNaN(c)||isNaN(d))return"NaN";a=v(a,"","");a+=v(b,"i",a);a+=v(c,"j",a);a+=v(d,"k",a);return""===a?"0":a},real:function(){return this.w},imag:function(){return[this.x,this.y,this.z]},toVector:function(){return[this.w,this.x,this.y,this.z]},toMatrix:function(a){var b=this.w,c=this.x,
d=this.y,e=this.z,g=b*b+c*c+d*d+e*e,f=0===g?0:2/g;g=f*b*c;var l=f*b*d;b=f*b*e;var m=f*c*c,n=f*c*d;c=f*c*e;var p=f*d*d;d=f*d*e;e*=f*e;return a?[[1-(p+e),n-b,c+l],[n+b,1-(m+e),d-g],[c-l,d+g,1-(m+p)]]:[1-(p+e),n-b,c+l,n+b,1-(m+e),d-g,c-l,d+g,1-(m+p)]},toMatrix4:function(a){var b=this.w,c=this.x,d=this.y,e=this.z,g=b*b+c*c+d*d+e*e,f=0===g?0:2/g;g=f*b*c;var l=f*b*d;b=f*b*e;var m=f*c*c,n=f*c*d;c=f*c*e;var p=f*d*d;d=f*d*e;e*=f*e;return a?[[1-(p+e),n-b,c+l,0],[n+b,1-(m+e),d-g,0],[c-l,d+g,1-(m+p),0],[0,0,
0,1]]:[1-(p+e),n-b,c+l,0,n+b,1-(m+e),d-g,0,c-l,d+g,1-(m+p),0,0,0,0,1]},clone:function(){return new h(this)},rotateVector:function(a){var b=this.w,c=this.x,d=this.y,e=this.z,g=a[0],f=a[1];a=a[2];var l=2*(d*a-e*f),m=2*(e*g-c*a),n=2*(c*f-d*g);return[g+b*l+d*n-e*m,f+b*m+e*l-c*n,a+b*n+c*m-d*l]},slerp:function(a,b,c,d){r(k,a,b,c,d);var e=this.w,g=this.x,f=this.y,l=this.z,m=k.w,n=k.x,p=k.y,w=k.z,u=e*m+g*n+f*p+l*w;0>u&&(e=-e,g=-g,f=-f,l=-l,u=-u);if(.9995<u)return function(q){return(new h(e+q*(m-e),g+q*(n-
g),f+q*(p-f),l+q*(w-l))).normalize()};var y=Math.acos(u),z=Math.sin(y);return function(q){var t=y*q;q=Math.sin(t);t=Math.cos(t)-u*q/z;q/=z;return new h(t*e+q*m,t*g+q*n,t*f+q*p,t*l+q*w)}}};h.ZERO=new h(0,0,0,0);h.ONE=new h(1,0,0,0);h.I=new h(0,1,0,0);h.J=new h(0,0,1,0);h.K=new h(0,0,0,1);h.EPSILON=1E-16;h.fromAxisAngle=function(a,b){var c=.5*b,d=a[0],e=a[1],g=a[2],f=Math.sin(c)/Math.sqrt(d*d+e*e+g*g);return new h(Math.cos(c),d*f,e*f,g*f)};h.fromBetweenVectors=function(a,b){var c=a[0],d=a[1],e=a[2],
g=b[0],f=b[1],l=b[2],m=c*g+d*f+e*l,n=d*l-e*f;e=e*g-c*l;c=c*f-d*g;return(new h(m+Math.sqrt(m*m+n*n+e*e+c*c),n,e,c)).normalize()};h.random=function(){var a=Math.random(),b=Math.random(),c=Math.random(),d=Math.sqrt(1-a);a=Math.sqrt(a);return new h(a*Math.cos(2*Math.PI*c),d*Math.sin(2*Math.PI*b),d*Math.cos(2*Math.PI*b),a*Math.sin(2*Math.PI*c))};h.fromEuler=function(a,b,c,d){var e=.5*a,g=.5*b,f=.5*c;c=Math.cos(e);b=Math.cos(g);a=Math.cos(f);e=Math.sin(e);g=Math.sin(g);f=Math.sin(f);return void 0===d||
"ZXY"===d?new h(c*b*a-e*g*f,c*a*g-b*e*f,c*b*f+a*e*g,b*a*e+c*g*f):"XYZ"===d||"RPY"===d?new h(c*b*a-e*g*f,b*a*e+c*g*f,c*a*g-b*e*f,c*b*f+a*e*g):"YXZ"===d?new h(c*b*a+e*g*f,c*a*g+b*e*f,b*a*e-c*g*f,c*b*f-a*e*g):"ZYX"===d||"YPR"===d?new h(c*b*a+e*g*f,c*b*f-a*e*g,c*a*g+b*e*f,b*a*e-c*g*f):"YZX"===d?new h(c*b*a-e*g*f,c*b*f+a*e*g,b*a*e+c*g*f,c*a*g-b*e*f):"XZY"===d?new h(c*b*a+e*g*f,b*a*e-c*g*f,c*b*f-a*e*g,c*a*g+b*e*f):null};"function"===typeof define&&define.amd?define([],function(){return h}):"object"===typeof exports?
(Object.defineProperty(h,"__esModule",{value:!0}),h["default"]=h,h.Quaternion=h,module.exports=h):A.Quaternion=h})(this);